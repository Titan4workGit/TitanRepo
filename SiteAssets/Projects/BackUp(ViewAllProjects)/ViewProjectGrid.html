<!----<link href="https://github.com/Titan4workGit/TitanRepo/tree/main/_catalogs/masterpage/Titan2/Styles/dataTables.bootstrap.min.css" rel="stylesheet" type="text/css">
<script src="https://github.com/Titan4workGit/TitanRepo/tree/main/_catalogs/masterpage/Titan2/Scripts/jquery.dataTables.js"></script>
<script src="https://github.com/Titan4workGit/TitanRepo/tree/main/_catalogs/masterpage/Titan2/Scripts/dataTables.bootstrap.js"></script>-->

<script src='https://github.com/Titan4workGit/TitanRepo/tree/main/SiteAssets/EmployeeSynchronous/table/Mytable.js'></script>
<link rel="stylesheet" type="text/css" href="https://github.com/Titan4workGit/TitanRepo/tree/main/SiteAssets/EmployeeSynchronous/table/tableStyle.css">

<script type="text/javascript">
var clientContext='';
var PrjectgridInitiated=false;
var IsProjectAdmin = false;
var sorterTableMyProjectList;
$(document).ready(function () {
	SP.SOD.executeOrDelayUntilScriptLoaded(getCurrentURL_GetProjectGridEvent,"sp.js");

	$("#CreateProject").hide();
	$( "#CreateProject" ).click(function() {
		var txtCompanyId =  titanForWork.getQueryStringParameter("CompanyId");
		var url = _spPageContextInfo.webServerRelativeUrl;
		var participatePage= url+"/Pages/ProjectDetails.aspx?WebAppId="+txtCompanyId;
		location.href=participatePage;
	});
});


function GenerateTableMyProjectList()
{
    sorterTableMyProjectList = new TINY.table.sorter('sorterTableMyProjectList', 'tableTempProjects', {
        headclass: 'head',
        ascclass: 'asc',
        descclass: 'desc',
        evenclass: 'evenrow',
        oddclass: 'oddrow',
        evenselclass: 'evenselected',
        oddselclass: 'oddselected',
        paginate: true,
        size: 10,
        colddid: 'columnsMyProject',
        currentid: 'currentpageMyProject',
        totalid: 'totalpagesMyProject',
        startingrecid: 'startrecordMyProject',
        endingrecid: 'endrecordMyProject',
        totalrecid: 'totalrecordsMyProject',
        hoverid: 'selectedrowMyProject',
        pageddid: 'pagedropdownMyProject',
        navid: 'tablenavMyProject',
        //sortcolumn: 1,//uncomment if you want to sorting on here on page loading by default on column based
        sortdir: 1,
        init: true
    });
}


function getCurrentURL_GetProjectGridEvent()
{

	// Bind Departments Dropdown
	$.when(BindDepartments()).done(function()
	{

	  
	
	});

}

function CheckTeamMemberForProject(projectId)
{
	var requestURI=_spPageContextInfo.webAbsoluteUrl + "/_api/lists/getByTitle('ProjectTeamDetails')/items?Select=ID,TeamMember/ID&$filter=ProjectId eq "+projectId+" and TeamMember/ID eq "+_spPageContextInfo.userId+"";
	$.ajax({
		url:requestURI,
		type:"GET",
		async:false,
		headers: { Accept: "application/json;odata=verbose" },
		success:function(data)
		{
			var results=data.d.results;

			return results.length;
		},
		error:function(data)
		{
			console.log(data);
		}
	})
}



function BindProjectGridProjectAdmin(PrjectgridInitiated, filterDepartment, filterStatus) {

	if(filterDepartment==null)
	{
	  filterDepartment="All";
	}

    if (PrjectgridInitiated == true) {
      //  $('#myFirstTable').dataTable().fnDestroy();
    }
    var restQuery = "";

    var txtCompanyId = titanForWork.getQueryStringParameter("CompanyId");
    //var clientContext = new SP.ClientContext();
    var Location = window.location.protocol + "//" + window.location.host + _spPageContextInfo.siteServerRelativeUrl;
   // var oList = clientContext.get_web().get_lists().getByTitle('ProjectDetails');
 //   var camlQuery = new SP.CamlQuery();
    //var camlXML = "<View><Query><Where><Eq><FieldRef Name='CompanyId' /><Value Type='Text'>" + txtCompanyId + "</Value></Eq></Where><OrderBy><FieldRef Name='ID' Ascending='False' /></OrderBy></Query></View>";
   // var camlXML = '';
    if (filterDepartment != "All" && filterStatus == "All")
    {
        restQuery = "&$filter=CompanyId eq '" + txtCompanyId + "' and DepartmentName eq '" + filterDepartment + "'";
        //camlXML = "<View><Query><Where><And><Eq><FieldRef Name='CompanyId' /><Value Type='Text'>" + txtCompanyId + "</Value></Eq><Eq><FieldRef Name='DepartmentName' /><Value Type='Text'>" + filterDepartment + "</Value></Eq></And></Where><OrderBy><FieldRef Name='ID' Ascending='False' /></OrderBy></Query></View>";
    }
    else if (filterDepartment == "All" && filterStatus != "All") {
        restQuery = "&$filter=CompanyId eq '" + txtCompanyId + "' and Status eq '" + filterStatus + "'";
        //camlXML = "<View><Query><Where><And><Eq><FieldRef Name='CompanyId' /><Value Type='Text'>" + txtCompanyId + "</Value></Eq><Eq><FieldRef Name='Status' /><Value Type='Text'>" + filterStatus + "</Value></Eq></And></Where><OrderBy><FieldRef Name='ID' Ascending='False' /></OrderBy></Query></View>";
    }
    else if (filterDepartment != "All" && filterStatus != "All") {
        restQuery = "&$filter=CompanyId eq '" + txtCompanyId + "' and Status eq '" + filterStatus + "' and DepartmentName eq '" + filterDepartment + "'";
       // camlXML = "<View><Query><Where><And><And><Eq><FieldRef Name='CompanyId' /><Value Type='Text'>" + txtCompanyId + "</Value></Eq><Eq><FieldRef Name='Status' /><Value Type='Text'>" + filterStatus + "</Value></Eq></And><Eq><FieldRef Name='DepartmentName' /><Value Type='Text'>" + filterDepartment + "</Value></Eq></And></Where><OrderBy><FieldRef Name='ID' Ascending='False' /></OrderBy></Query></View>";
    }
    else {
        restQuery = "&$filter=CompanyId eq '" + txtCompanyId + "'";
        //camlXML = "<View><Query><Where><Eq><FieldRef Name='CompanyId' /><Value Type='Text'>" + txtCompanyId + "</Value></Eq></Where><OrderBy><FieldRef Name='ID' Ascending='False' /></OrderBy></Query></View>";
    }
debugger;
    var Ownurl = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('ProjectDetails')/items?$expand=ManagerName,ClientID&$orderby=Title&$select=*,ManagerName/Title,ManagerName/Id,ClientID/Title,ClientID/Id" + restQuery;
    $.ajax({
        url: Ownurl,
        method: "GET",
        headers: { "Accept": "application/json; odata=verbose" },
        async: true,
        success: function (data)
        {
            var response = data.d.results;
            var myData = [];
            var counter = 1;
            var tr = "";
            var itemsCount = 0;
            for(var i=0;i<response.length;i++)
            {
                itemsCount++;
                var ProjectName = response[i].ProjectName;

                var ProjectCode = response[i].ProjectCode;
                var ProjectDescription = response[i].ProjectDescription;
             //   var ClientName = response[i].ClientName;
             	var ClientName = response[i].ClientID.Title;
                if(ClientName==null || ClientName=='' || ClientName==undefined)
				{
					ClientName="N/A";
				}				
                var PartnerName = response[i].PartnerName;
                var ActualStartDate = response[i].ActualStartDate;//new Date(response[i].ActualStartDate'));
                if (ActualStartDate != '' && ActualStartDate != null) {
                    ActualStartDate = new Date(ActualStartDate);
                    ActualStartDate = $.datepicker.formatDate('dd-M-yy', ActualStartDate);
                }
                else {
                    ActualStartDate = "N/A";
                }
                //ActualStartDate= $.datepicker.formatDate('dd-mm-yy', ActualStartDate);

                var ActualEndDate = response[i].ActualEndDate;
                if (ActualEndDate != '' && ActualEndDate != null) {
                    ActualEndDate = new Date(ActualEndDate);
                    ActualEndDate = $.datepicker.formatDate('dd-M-yy', ActualEndDate);
                }
                else {
                    ActualEndDate = "N/A";
                }

                var PlanedStartDate = new Date(response[i].PlanedStartDate);
                PlanedStartDate = $.datepicker.formatDate('dd-M-yy', PlanedStartDate);
                //PlanedStartDate = PlanedStartDate.getDay() +"/"+(PlanedStartDate.getMonth()+1 )+"/"+ PlanedStartDate.getFullYear();

                var PlanedEndDate = new Date(response[i].PlanedEndDate);
                PlanedEndDate = $.datepicker.formatDate('dd-M-yy', PlanedEndDate);
                //PlanedEndDate = PlanedEndDate.getDay() +"/"+(PlanedEndDate.getMonth()+1 )+"/"+ PlanedEndDate.getFullYear();

                var ManagerDetails = response[i].ManagerName;
                var ManagerName =response[i].ManagerName.Title// ManagerDetails.get_lookupValue();
                var ManagerId =response[i].ManagerName.Id;// ManagerDetails.get_lookupId();
                var TechnologyUsed = response[i].TechnologyUsed;
                var Status = response[i].Status;
                var DepartmentName = response[i].DepartmentName;
                //var CreatedDate = response[i].Created');

                var ItemID = response[i].ID;


                var myObject = [];
                var url = "<a href='" + Location + "/Pages/ViewProjectDetails.aspx?WebAppId=" + txtCompanyId + "&ProjectID=" + ItemID + "&ProjectName=" + ProjectName + "'>" + ProjectName + "</a>";
                var editUrl = '';
                //if (ManagerId == _spPageContextInfo.userId) {
                editUrl = "<a href='" + Location + "/Pages/EditProjectDetails.aspx?WebAppId=" + txtCompanyId + "&ProjectID=" + ItemID + "&ProjectName=" + ProjectName + "'>Edit</a>";
                //}
                //else {
                //   editUrl = "N/A";
                //}
                if (Status == "Completed") {
                    Status = "<p style='color:green;text-align:center;'>" + Status + "</p>";
                }
                else if (Status == "Terminated") {
                    Status = "<p style='color:red;text-align:center;'>" + Status + "</p>";
                }
                else if (Status == "Live") {
                    Status = "<p style='color:blue;text-align:center;'>" + Status + "</p>";
                }
                else if (Status == "OnHold") {
                    Status = "<p style='color:orange;text-align:center;'>" + Status + "</p>";
                }
                //myObject.push(ProjectCode);
                //myObject.push(url);
                //myObject.push(ManagerName);
                //myObject.push(DepartmentName);
                //myObject.push(PlanedStartDate);
                //myObject.push(PlanedEndDate);
                //myObject.push(Status);
                //myObject.push(ClientName);
                //myObject.push(ActualStartDate);
                //myObject.push(ActualEndDate);
                //myObject.push(editUrl);
                //myObject.push(ItemID);
                //myData.push(myObject);
                tr = tr + "<tr><td>" + ProjectCode + "</td><td>" + url + "</td><td>" + ManagerName + "</td><td>" + DepartmentName + "</td><td>" + PlanedStartDate + "</td><td>" + PlanedEndDate + "</td><td>" + Status + "</td><td>" + ClientName + "</td><td>" + ActualStartDate + "</td><td>" + ActualEndDate + "</td><td>" + editUrl + "</td></tr>";


                counter++;

            }
            //$('#myFirstTable').DataTable({
            //    data: myData,
            //    "order": [11, 'desc'],
            //    columns: [
            //        { title: "Project Code" },
            //        { title: "Project Name" },
            //        { title: "Project Manager" },
            //        { title: "Department" },
            //        { title: "Planned Start Date" },
            //        { title: "Planned End Date" },
            //        { title: "Status" },
            //        { title: "End-Customer" },
            //        { title: "Actual Start Date" },
            //        { title: "Actual End Date" },
            //        { title: "Edit" },
            //        { title: "ID" }
            //    ],
            //    "columnDefs": [
            //       {
            //           "targets": [11],
            //           "visible": false
            //       }
            //    ]

            //});

            $("#tableTempProjects>tbody").html("");
            $('#mydmsNorecordFound').hide();
            if (itemsCount == 0) {
                $('#mydmsNorecordFound').show();
             $("#tablefooterMyProject").hide();
        }
        else
        {
          $("#tablefooterMyProject").show();
        }

            // dvTable.append(completebody);
            var completebody = tr;
            $("#tableTempProjects>tbody").append(completebody);
            if (itemsCount > 0)
            {
                GenerateTableMyProjectList();
                $('.myListPagingValue').prop('selectedIndex', 1);
                $("#columnsMyProject").empty();
                $("#columnsMyProject").append('<option value="-1">All Columns</option>');
                $("#columnsMyProject").append('<option value="0">Project Code</option>');
                $("#columnsMyProject").append('<option value="1">Project Name</option>');
                $("#columnsMyProject").append('<option value="2">Project Manager</option>');
                $("#columnsMyProject").append('<option value="3">Department</option>');
                $("#columnsMyProject").append('<option value="4">Planned Start Date</option>');
                $("#columnsMyProject").append('<option value="5">Planned End Date</option>');
                $("#columnsMyProject").append('<option value="6">Status</option>');
                $("#columnsMyProject").append('<option value="7">End-Customer</option>');
                $("#columnsMyProject").append('<option value="8">Actual Start Date</option>');
                $("#columnsMyProject").append('<option value="9">Actual End Date</option>');
            }



        },
        error: function (data) {
            console.log(JSON.stringify(data));
        }
    });
}

function BindProjectGridNormalUsers(PrjectgridInitiated,filterDepartment,filterStatus)
{
    if (PrjectgridInitiated == true) {
       // $('#myFirstTable').dataTable().fnDestroy();
    }

    var txtCompanyId =  titanForWork.getQueryStringParameter("CompanyId");
    var clientContext=new SP.ClientContext();
    var Location= window.location.protocol + "//" + window.location.host + _spPageContextInfo.siteServerRelativeUrl;
    var oList = clientContext.get_web().get_lists().getByTitle('ProjectDetails');
    var camlQuery = new SP.CamlQuery();
    var camlXML ='';
    if(filterDepartment != "All" && filterStatus=="All")
    {
        camlXML = "<View><Query><Where><And><Eq><FieldRef Name='CompanyId' /><Value Type='Text'>"+txtCompanyId+"</Value></Eq><Eq><FieldRef Name='DepartmentName' /><Value Type='Text'>"+filterDepartment+"</Value></Eq></And></Where><OrderBy><FieldRef Name='ID' Ascending='False' /></OrderBy></Query></View>";
    }
    else if(filterDepartment == "All" && filterStatus!="All")
    {
        camlXML = "<View><Query><Where><And><Eq><FieldRef Name='CompanyId' /><Value Type='Text'>"+txtCompanyId+"</Value></Eq><Eq><FieldRef Name='Status' /><Value Type='Text'>"+filterStatus+"</Value></Eq></And></Where><OrderBy><FieldRef Name='ID' Ascending='False' /></OrderBy></Query></View>";
    }
    else if(filterDepartment != "All" && filterStatus!="All")
    {
        camlXML = "<View><Query><Where><And><And><Eq><FieldRef Name='CompanyId' /><Value Type='Text'>"+txtCompanyId+"</Value></Eq><Eq><FieldRef Name='Status' /><Value Type='Text'>"+filterStatus+"</Value></Eq></And><Eq><FieldRef Name='DepartmentName' /><Value Type='Text'>"+filterDepartment+"</Value></Eq></And></Where><OrderBy><FieldRef Name='ID' Ascending='False' /></OrderBy></Query></View>";
    }
	else
    {
        camlXML = "<View><Query><Where><Eq><FieldRef Name='CompanyId' /><Value Type='Text'>" + txtCompanyId + "</Value></Eq></Where><OrderBy><FieldRef Name='ID' Ascending='False' /></OrderBy></Query></View>";
    }

    camlQuery.set_viewXml(camlXML);
    var collListItem = oList.getItems(camlQuery);
    clientContext.load(collListItem);
    clientContext.executeQueryAsync(function(){
        var myData=[];
        var listItemEnumerator = collListItem.getEnumerator();
        var ItemCount=collListItem.get_count();

        var counter = 1;
        var tr = "";
        var itemsCount = 0;


        while (listItemEnumerator.moveNext())
        {
            var oListItem = listItemEnumerator.get_current();

            ///////////////////////////////////
            var projectId=oListItem.get_item('ID');
            var ProjectName=oListItem.get_item('ProjectName');
           var requestURI=_spPageContextInfo.webAbsoluteUrl + "/_api/lists/getByTitle('ProjectTeamDetails')/items?$Select=ID,Status,TeamMember/ID&$expand=TeamMember&$filter=Status eq 'Active' and ProjectId eq '"+projectId+"' and TeamMember/ID eq "+_spPageContextInfo.userId+"";

            $.ajax({
                url:requestURI,
                type:"GET",
                async:false,
                headers: { Accept: "application/json;odata=verbose" },
                success:function(data)
                {
                    var results=data.d.results;

                    if(results.length!=0)
                    {
                        var ProjectCode=oListItem.get_item('ProjectCode');
                        var ProjectName=oListItem.get_item('ProjectName');
                        var ProjectDescription=oListItem.get_item('ProjectDescription');
                        var ClientName=oListItem.get_item('ClientName');
                        var PartnerName=oListItem.get_item('PartnerName');
                        var ActualStartDate= oListItem.get_item('ActualStartDate');//new Date(oListItem.get_item('ActualStartDate'));

                        if(ActualStartDate!='' && ActualStartDate!=null)
                        {
                            ActualStartDate=new Date(ActualStartDate);
                            ActualStartDate=$.datepicker.formatDate('dd-M-yy', ActualStartDate);
                        }
                        else
                        {
                            ActualStartDate="N/A";
                        }
                        //ActualStartDate= $.datepicker.formatDate('dd-mm-yy', ActualStartDate);

                        var ActualEndDate=oListItem.get_item('ActualEndDate');
                        if(ActualEndDate!='' && ActualEndDate!=null)
                        {
                            ActualEndDate=new Date(ActualEndDate);
                            ActualEndDate=$.datepicker.formatDate('dd-M-yy', ActualEndDate);
                        }
                        else
                        {
                            ActualEndDate="N/A";
                        }


                        //var ActualStartDate=new Date(oListItem.get_item('ActualStartDate'));
                        //ActualStartDate= $.datepicker.formatDate('dd-mm-yy', ActualStartDate);
                        //ActualStartDate = ActualStartDate.getDay() +"/"+(ActualStartDate.getMonth()+1 )+"/"+ ActualStartDate.getFullYear();

                        //var ActualEndDate=new Date(oListItem.get_item('ActualEndDate'));
                        //ActualEndDate= $.datepicker.formatDate('dd-mm-yy', ActualEndDate);
                        //ActualEndDate = ActualEndDate.getDay() +"/"+(ActualEndDate.getMonth()+1 )+"/"+ ActualEndDate.getFullYear();

                        var PlanedStartDate=new Date(oListItem.get_item('PlanedStartDate'));
                        PlanedStartDate= $.datepicker.formatDate('dd-M-yy', PlanedStartDate);
                        //PlanedStartDate = PlanedStartDate.getDay() +"/"+(PlanedStartDate.getMonth()+1 )+"/"+ PlanedStartDate.getFullYear();

                        var PlanedEndDate=new Date(oListItem.get_item('PlanedEndDate'));
                        PlanedEndDate= $.datepicker.formatDate('dd-M-yy', PlanedEndDate);
                        //PlanedEndDate = PlanedEndDate.getDay() +"/"+(PlanedEndDate.getMonth()+1 )+"/"+ PlanedEndDate.getFullYear();

                        var ManagerDetails=oListItem.get_item('ManagerName');
                        var ManagerName=ManagerDetails.get_lookupValue();
                        var ManagerId=ManagerDetails.get_lookupId();
                        var TechnologyUsed=oListItem.get_item('TechnologyUsed');
                        var Status=oListItem.get_item('Status');
                        var DepartmentName=oListItem.get_item('DepartmentName');

                        var ItemID=oListItem.get_item('ID');
                        //var CreatedDate=oListItem.get_item('Created');

                        var myObject=[];
                        var url="<a href='"+Location+"/Pages/ViewProjectDetails.aspx?WebAppId="+txtCompanyId+"&ProjectID="+ItemID+"&ProjectName="+ProjectName+"'>"+ProjectName+"</a>";
                        if(ManagerId==_spPageContextInfo.userId)
                        {
                            editUrl="<a href='"+Location+"/Pages/EditProjectDetails.aspx?WebAppId="+txtCompanyId+"&ProjectID="+ItemID+"&ProjectName="+ProjectName+"'>Edit</a>";
                        }
                        else
                        {
                            editUrl="N/A";
                        }

                        if(Status=="Completed")
                        {
                            Status="<p style='color:green;text-align:center'>"+Status+"</p>";
                        }
                        else if(Status=="Terminated")
                        {
                            Status="<p style='color:red;text-align:center'>"+Status+"</p>";
                        }
                        else if(Status=="Live")
                        {
                            Status="<p style='color:blue;text-align:center'>"+Status+"</p>";
                        }
                        else if(Status=="OnHold")
                        {
                            Status="<p style='color:orange;text-align:center'>"+Status+"</p>";
                        }


                        tr = tr + "<tr><td>"+ProjectCode+"</td><td>"+url+"</td><td>"+ManagerName+"</td><td>"+DepartmentName+"</td><td>"+PlanedStartDate+"</td><td>"+PlanedEndDate+"</td><td>"+Status+"</td><td>"+ClientName+"</td><td>"+ActualStartDate+"</td><td>"+ActualEndDate+"</td><td>"+editUrl+"</td></tr>";
itemsCount++;

                   /*     myObject.push(ProjectCode);
                        myObject.push(url);
                        myObject.push(ManagerName);
                        myObject.push(DepartmentName);
                        myObject.push(PlanedStartDate);
                        myObject.push(PlanedEndDate);
                        myObject.push(Status);
                        myObject.push(ClientName);
                        myObject.push(ActualStartDate);
                        myObject.push(ActualEndDate);
                        myObject.push(editUrl);
                        myObject.push(ItemID);
                        myData.push(myObject);*/
                        counter++;

                    }
                },
                error:function(data)
                {
                    console.log("BindProjectGridNormalUsers method" + data);
                }
            });
		 }
		////////////////////////////////////
        //$('#myFirstTable').DataTable( {
        //    data: myData,
        //    "order": [ 11, 'desc' ],
        //    columns: [
        //        { title: "Project Code" },
        //        { title: "Project Name" },
        //        { title: "Project Manager" },
        //        { title: "Department"},
        //        { title: "Planned Start Date" },
        //        { title: "Planned End Date" },
        //        { title: "Status" },
        //        { title: "End-Customer" },
        //        { title: "Actual Start Date" },
        //        { title: "Actual End Date" },
        //        { title: "Edit" }
        //    ],
        //    "columnDefs": [
        //       {
        //           "targets": [ 11 ],
        //           "visible": false
        //       }
        //    ]
        //} );

        $("#tableTempProjects>tbody").html("");
        $('#mydmsNorecordFound').hide();
        if (itemsCount == 0) 
        {
            $('#mydmsNorecordFound').show();
            $("#tablefooterMyProject").hide();
        }
        else
        {
          $("#tablefooterMyProject").show();
        }
       // debugger;
        // dvTable.append(completebody);
        var completebody = tr;
        $("#tableTempProjects>tbody").append(completebody);
       if (itemsCount> 0)
        {
            GenerateTableMyProjectList();
            $('.myListPagingValue').prop('selectedIndex', 1);
            $("#columnsMyProject").empty();
            $("#columnsMyProject").append('<option value="-1">All Columns</option>');
            $("#columnsMyProject").append('<option value="0">Project Code</option>');
            $("#columnsMyProject").append('<option value="1">Project Name</option>');
            $("#columnsMyProject").append('<option value="2">Project Manager</option>');
            $("#columnsMyProject").append('<option value="3">Department</option>');
            $("#columnsMyProject").append('<option value="4">Planned Start Date</option>');
            $("#columnsMyProject").append('<option value="5">Planned End Date</option>');
            $("#columnsMyProject").append('<option value="6">Status</option>');
            $("#columnsMyProject").append('<option value="7">End-Customer</option>');
            $("#columnsMyProject").append('<option value="8">Actual Start Date</option>');
            $("#columnsMyProject").append('<option value="9">Actual End Date</option>');
        }
    })
 }


$(function() {
    bindButtonClick();
});

function bindButtonClick() {
	$("#FilterGo").on("click", function() {
		var filterDepartment= $('#txtFilterDepartment').val();
		var filterStatus= $('#txtFilterStatus').val();
		PrjectgridInitiated=true;
		if(IsProjectAdmin)
		{
			BindProjectGridProjectAdmin(PrjectgridInitiated,filterDepartment,filterStatus);
		}
		else
		{
			BindProjectGridNormalUsers(PrjectgridInitiated,filterDepartment,filterStatus);
		}
	});
}


function getProjectRights()
{
	var deffered= $.Deferred();

	var result;
	var listName='ProcessApprovers';
	var txtCompanyId =  titanForWork.getQueryStringParameter("CompanyId");
    var siteURL = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('"+listName+"')/items?$select=*&$filter=CompanyId eq '" + txtCompanyId + "' and ContributorsId eq '"+_spPageContextInfo.userId+"' and WebPartName eq 'Project Admin'";
    $.ajax({
        url: siteURL,
        headers: { Accept: "application/json;odata=verbose" },
        async: true,
        success: function (data)
        {
            var items = data.d.results;
            if (items.length>0)
            {
                $("#CreateProject").show();
                deffered.resolve(true);
                $("#hdnIsProjectAdmin").val(true);
                IsProjectAdmin=true;
            }
			else
			{
				$("#hdnIsProjectAdmin").val(false);
				$("#CreateProject").hide();
				deffered.resolve(false);
				IsProjectAdmin=false;
			}

        }, eror: function (data)
        {
            console.log($('#txtSomethingWentWrong').val());
        }
    });
    return deffered.promise();
}

function BindDepartments()
{
	var txtCompanyId =  titanForWork.getQueryStringParameter("CompanyId");
	var clientContext= new SP.ClientContext();
	var oList = clientContext.get_web().get_lists().getByTitle('Departments');
    var camlQuery = new SP.CamlQuery();
	var camlXML = "<View><Query><Where><Eq><FieldRef Name='CompanyID' /><Value Type='Lookup'>"+txtCompanyId+"</Value></Eq></Where><OrderBy><FieldRef Name='Title'/></OrderBy></Query></View>";
	camlQuery.set_viewXml(camlXML);
	var collListItem = oList.getItems(camlQuery);
	clientContext.load(collListItem);
	clientContext.executeQueryAsync(function(){
		var listItemEnumerator = collListItem.getEnumerator();
		//var counter=1;
		var departmentHTML ='<option value="All">All</option>';
		while (listItemEnumerator.moveNext())
		{
			var oListItem = listItemEnumerator.get_current();
			var departmentID=oListItem.get_item('ID');
			var departmentTitle=oListItem.get_item('Title');
			departmentHTML +='<option value="'+departmentTitle+'">'+departmentTitle+'</option>';
			//counter++;
		}
		$("#txtFilterDepartment").append(departmentHTML);

		//departmentHTML +='</select>';
		//$("#departmentDiv").append(departmentHTML);
		
		
		 $.when(getProjectRights()).done(function(isProjectAdmin){
 		var filterDepartment= $('#txtFilterDepartment').val();
		var filterStatus= $('#txtFilterStatus').val();
		if(isProjectAdmin)
		{
			BindProjectGridProjectAdmin(PrjectgridInitiated,filterDepartment,filterStatus);
		}
		else
		{
			BindProjectGridNormalUsers(PrjectgridInitiated,filterDepartment,filterStatus);
		}
	  });
		
		
	},

	function(){
		console.log('error : Project Details web part');
	});
}



</script>


<div class=" row department-header my_project_grid">
    <ol class="breadcrumb">
        <li><h4><b>View Project Grid</b></h4></li>
    </ol>
</div>
<div class="panel-heading   panel-head-4">
    <div class="panel-title">
        <h4 class="h4-color">Project List </h4>
        <button type="button" class="btn btn-outline-primary" id="CreateProject">New Project</button>
    </div>
</div>
<section class="content shadow2 panel">
    <div class="container-fluid">
        <div class="row margin10 my_projects_list_single_box">
            <div class="vertical_align my_projects_list_grid1">
                <!-- class-"col-md-0" -->
                <label for="inputEmail6" class="col-sm-2 col-lg-1 single_row_label single_float_left margin_bottom label_font_normal ">Department</label>
                <div class="col-sm-3 col-lg-2 padding-left-4 single_row_control">
                    <select name="select5" class="form-control" id="txtFilterDepartment"></select>
                </div>
                <!-- class-"col-md-0" -->
                <label for="inputEmail5" class="col-sm-2 col-lg-1 single_row_label single_float_left margin_bottom label_font_normal ">Status</label>
                <div class="col-sm-3 col-lg-2 padding-left-4 single_row_control">
                    <select name="select6" class="form-control" id="txtFilterStatus">
                        <option>Live</option>
                        <option>All</option>
                        <option>OnHold</option>
                        <option>Terminated</option>
                        <option>Completed</option>
                    </select>
                </div>
                <div class="col-lg-1 col-md-2 col-sm-2 col-xs-2 filter-res single_row_btn single_float_left">
                    <button type="button" class="btn-outline-primary btn-sm form-control btn-display" id="FilterGo">Filter</button>
                </div>
                <!-- <div class="col-md-2 float_right createproj"> -->
                    <!--<button type="button" class="form-control btn btn-primary btn-sm btn-display" id="CreateProject">Create New Project</button>-->
                    <!-- <button type="button" class="btn btn-outline-primary" id="CreateProject">New Project</button> -->
                <!-- </div> -->
            </div>
            <input type="text" id="queryMyProject" onkeyup="sorterTableMyProjectList.search('queryMyProject')" placeholder="Search..." class="doc-search single_row_control single_float_right" style="width:200px;margin-left:4px; font-size: 13px;padding:8px 5px !Important; float:left;" />
            <select class="form-control single_row_control single_float_right" style="width:200px;font-size: 13px; float:left" id="columnsMyProject" onchange="sorterTableMyProjectList.search('query')"></select>  
        </div>
        <div class="row clearfix margin10">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="card">
                    <div class="body">
                        <div class="table-responsive">
                            <!--<table id="myFirstTable" class="table table-bordered table-striped table-hover js-basic-example dataTable"></table>-->
                            <div id="tablewrapper">
                                <div id="tableheader" style="height: auto !important;">
                                    <div class="search" style="display:none;">

                                    </div>
                                    <div>
                                        <span class="details">
                                            <div style="display:none;">Records  <span id="startrecordMyProject"></span>-<span id="endrecordMyProject"></span> PagesOf  <span id="totalrecordsMyProject"></span></div>
                                            <div style="display:none;"><a href="javascript:sorterTableMyProjectList.reset()">Reset </a></div>
                                        </span>
                                    </div>
                                </div>
                                <!-- <div class="mrg-top-10m  btm10 container">
                                    <div class="row">
                                        <select class="form-control" style="width:200px;font-size: 13px; float:left" id="columnsMyProject" onchange="sorterTableMyProjectList.search('query')"></select>
                                        <input type="text" id="queryMyProject" onkeyup="sorterTableMyProjectList.search('queryMyProject')" placeholder="Search..." class="doc-search" style="width:200px;margin-left:4px; font-size: 13px;padding:8px 5px !Important; float:left;" />
                                    </div>
                                </div> -->
                                <div>

                                    <div id='mainTablearea' class='table-responsive'><table cellpadding='0' cellspacing='0' border='1' id='tableTempProjects' class='table-width tinytable table table-bordered table-striped table-hover js-basic-example dataTable no-footer mydptdoc_table'></div>
                                    <thead class='panel-heading '>
                                        <tr>
                                            <th><h6 data-localize="ProjectCode">Project Code</h6></th>
                                            <th><h6 data-localize="ProjectName">Project Name</h6></th>
                                            <th><h6 data-localize="ProjectManager">Project Manager</h6></th>
                                            <th><h6 data-localize="Department">Department</h6></th>
                                            <th><h6 data-localize="PlannedStartDate">Planned Start Date</h6></th>
                                            <th><h6 data-localize="PlannedEndDate">Planned End Date</h6></th>
                                            <th><h6 data-localize="Status">Status</h6></th>
                                            <th><h6 data-localize="Customer">Customer</h6></th>
                                            <th><h6 data-localize="ActualStartDate">Actual Start Date</h6></th>
                                            <th><h6 data-localize="ActualEndDate">Actual End Date</h6></th>
                                            <th class='nosort' style='max-width:62px;width:62px'><h6 data-localize="Action">Action</h6></th>
                                        </tr>
                                    </thead><tbody class='panel' id="mainDivAreaOffice365"></tbody></table>
                                    <div style='text-align: center;font-size:14px;display:none' id="norecordFoundMyProject" data-localize="NoRecordFound">No Record Found</div>



                                </div>
                                <div id="tablefooterMyProject" style="margin-bottom: 10px;">
                                    <div id="tablenavMyProject">
                                        <div>
                                            <img src="https://github.com/Titan4workGit/TitanRepo/tree/main/SiteAssets/EmployeeSynchronous/table/first.gif" width="16" height="16" alt="First Page" onclick="sorterTableMyProjectList.move(-1,true)" />
                                            <img src="https://github.com/Titan4workGit/TitanRepo/tree/main/SiteAssets/EmployeeSynchronous/table/previous.gif" width="16" height="16" alt="First Page" onclick="sorterTableMyProjectList.move(-1)" />
                                            <img src="https://github.com/Titan4workGit/TitanRepo/tree/main/SiteAssets/EmployeeSynchronous/table/next.gif" width="16" height="16" alt="First Page" onclick="sorterTableMyProjectList.move(1)" />
                                            <img src="https://github.com/Titan4workGit/TitanRepo/tree/main/SiteAssets/EmployeeSynchronous/table/last.gif" width="16" height="16" alt="Last Page" onclick="sorterTableMyProjectList.move(1,true)" />
                                        </div>
                                        <div>
                                            <select id="pagedropdownMyProject"></select>
                                        </div>
                                        <div>
                                            <a href="javascript:sorterTableMyProjectList.showall()" data-localize="ViewAll">ViewAll </a>
                                        </div>
                                    </div>
                                    <div id="tablelocationMyProject">
                                        <div>
                                            <span data-localize="LinesPerPage">Lines Per Page</span>
                                            <select class="myListPagingValue" onchange="sorterTableMyProjectList.size(this.value)">
                                                <option value="5">5</option>
                                                <option value="10" selected="selected">10</option>
                                                <option value="20">20</option>
                                                <option value="50">50</option>
                                                <option value="100">100</option>
                                            </select>
                                        </div>
                                        <div class=""><span data-localize="Page">Page</span><span id="currentpageMyProject"></span><span data-localize="Of">of</span><span id="totalpagesMyProject"></span></div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<input id="hdnIsProjectAdmin" type="hidden" value="false">

<style>
    .btn-display {
        display: block;
    }

    .vertical_align {
        vertical-align: middle;
        line-height: 34px;
    }

    .margin_bottom {
        margin-bottom: 0px !important;
    }

    .padding_left {
        padding-left: 0px !important;
    }

    .ms-webpart-zone.ms-fullWidth {
        display: block !important;
    }

    .ms-webpart-cell-horizontal {
        display: block !important;
    }

    .float_right {
        float: right;
    }

    .createproj {
        width: 183px;
    }

    .padding-left-4 {
        padding-left: 4px;
    }

    .label_font_normal {
        font-weight: normal;
    }

    /* new css added on 21/5/19 */

    .my_project_grid ol.breadcrumb {
        display: none;
    }

    .my_project_grid {
        margin-top: 5px;
    }

    #FilterGo {
        color: #386cbb;
        border-radius: 2px;
    }

        #FilterGo:hover {
            color: #fff;
        }

    @media only screen and (max-width:768px) {
        .btn-display {
            display: inline-block;
        }

        .padding-left-4 {
            padding-left: 15px;
        }
    }

    .createproj button#CreateProject, button#FilterGo {
        font-size: 14px !important;
    }
    
#tablefooterMyProject 
{
    height: 20px;
    margin-top: 10px;
    margin-bottom: 10px;
}
#tablenavMyProject {
    float: left;
}
    
#tablenavMyProject div 
{
    float: left;
    margin-right: 15px;
}

#tablelocationMyProject {
    float: right;
    font-size: 12px;
}
#tablelocationMyProject div {
    float: left;
    margin-left: 15px;
}

    
    
</style>

<html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">
<head>
    <!--[if gte mso 9]><xml>
    <mso:CustomDocumentProperties>
    <mso:_dlc_DocId msdt:dt="string">ADMIN-1645029823-1621</mso:_dlc_DocId>
    <mso:_dlc_DocIdItemGuid msdt:dt="string">f81ec62e-5b64-44d5-8f6b-28062a6380a7</mso:_dlc_DocIdItemGuid>
    <mso:_dlc_DocIdUrl msdt:dt="string">https://adaptindia.sharepoint.com/sites/Titan_2_2_1_DEV/_layouts/15/DocIdRedir.aspx?ID=ADMIN-1645029823-1621, ADMIN-1645029823-1621</mso:_dlc_DocIdUrl>
    <mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_Editor msdt:dt="string">Mona Gupta</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_Editor>
<mso:Order msdt:dt="string">32900.0000000000</mso:Order>
<mso:_ExtendedDescription msdt:dt="string"></mso:_ExtendedDescription>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_Author msdt:dt="string">Rakesh Khambra</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_Author>
<mso:ContentTypeId msdt:dt="string">0x010100AB3CA9BBCC75BB4D960EDF9C33169BDB</mso:ContentTypeId>
<mso:MediaServiceImageTags msdt:dt="string"></mso:MediaServiceImageTags>
<mso:lcf76f155ced4ddcb4097134ff3c332f msdt:dt="string"></mso:lcf76f155ced4ddcb4097134ff3c332f>
<mso:TaxCatchAll msdt:dt="string"></mso:TaxCatchAll>
</mso:CustomDocumentProperties>
    </xml><![endif]-->
<title></title></head>
