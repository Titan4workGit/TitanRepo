<script type="text/javascript">

var clientContext='';
$(document).ready(function () {
GetOfficeLocation();
getRooms($('#ddlMeetingItemLocation').val());

$('#txtMeetingItemLocation').change(function(){

              var rooms= $('#txtMeetingItemLocation').val();
               var location= $('#ddlMeetingItemLocation').val();
               var hmlContent=GetRoomFacility(rooms,location);
               if(hmlContent=="")
               {
                hmlContent="No Facility available !"
               }
               $('#divfacility').html('');
               $('#divfacility').append(hmlContent);
});


$("#ddlMeetingItemLocation").change(function(){
		
		getRooms($('#ddlMeetingItemLocation').val());			
});

getMeetingCategory("","dropdown");
 $('#txtMeetingStartDate').datepicker({ 
					  changeMonth: true,
					  changeYear: true,
					  minDate: 0, 
					  yearRange: "0:+2"
					
				 }); 
			    $('#txtMeetingStartDate').datepicker("option", "dateFormat", "dd/mm/yy").datepicker("setDate", "0");
			    
			     $('#txtMeetingEndDate').datepicker({ 
					  changeMonth: true,
					  changeYear: true,
					  minDate: 0, 
					  yearRange: "0:+2"
					  
				 }); 
			    $('#txtMeetingEndDate').datepicker("option", "dateFormat", "dd/mm/yy").datepicker("setDate", "0");
			    

$(".Meeting_Add").unbind().click(function(){
		
		$("#myAddNewMeetingModal").modal('show');
		$('#txtMeetingItemTitle').val('');
		//$('#txtMeetingItemLocation').val('');
		$('#txtNewMeetingDescription').val('');
		$('#txtMeetingStartDate').datepicker("option", "dateFormat", "dd/mm/yy").datepicker("setDate", "0");
		$('#txtMeetingEndDate').datepicker("option", "dateFormat", "dd/mm/yy").datepicker("setDate", "0");		
});

$(".addnewMeetingCategoryModel").unbind().click(function(){
		
		$("#myMeetingCategoryModal").modal('show');
		$('#txtMeetingcategory').val('');
			
});
$(".addnewMeetingCategory").click(function(){
		
		$("#myMeetingCategoryModal").modal('show');
		var txtcategory=$('#txtMeetingcategory').val().trim();	
		if(txtcategory.length==0)
		{
		    alert('Please enter category name.');
	    	return false;
		}
		var categoryCounts=getMeetingCategory(txtcategory,"");		
		if(categoryCounts>0)
		{
		    alert('Category name is already exist.');
	    	return false;
		}	
		 AddMeetingCategory(txtcategory);	
});

$(".addNewCompanyMeeting").click(function()
{
    var addOneMinute=$('#ddlMeetingStartMinutes').val();
    
    if(addOneMinute=="00")
    {
      addOneMinute="01";
    }
    else if(addOneMinute=="05")
    {
        addOneMinute="06";
    }
    else
    {
    addOneMinute=parseInt(addOneMinute)+1;
    }  
     
     var validationstartHoursWithMinutes= $('#ddlMeetingStartTime').val().split(' ')[0]+":"+addOneMinute+" "+$('#ddlMeetingStartTime').val().split(' ')[1];
	var startHoursWithMinutes= $('#ddlMeetingStartTime').val().split(' ')[0]+":"+$('#ddlMeetingStartMinutes').val()+" "+$('#ddlMeetingStartTime').val().split(' ')[1];
    var endHoursWithMinutes = $('#ddlMeetingEndTime').val().split(' ')[0] + ":" + $('#ddlMeetingEndMinutes').val() + " " + $('#ddlMeetingEndTime').val().split(' ')[1];	
    var txtEventItemTitle = $('#txtMeetingItemTitle').val().trim();
    if(txtEventItemTitle.length==0)
    {
       alert('Please enter meeting title.');
       return false;
    }
    else if(txtEventItemTitle.length>250)
    {
	     alert('Meeting title maximum 250 characters allowed.');
	     return false;
    }
    
    
    var meetinggRoomLocationn=$('#ddlMeetingItemLocation').val();
     if(meetinggRoomLocationn==null)
    {
         alert('Please select location.');
	     return false;

    }

    if(meetinggRoomLocationn==0 || meetinggRoomLocationn==null)
    {
         alert('Please select location.');
	     return false;

    }
    
    var txtEventItemLocation = $('#txtMeetingItemLocation').val();
     if(txtEventItemLocation==null)
    {
	     alert('Please select room.');
	     return false;
    }
    if(txtEventItemLocation.length==0)
    {
	     alert('Please select room.');
	     return false;
    } 
    var validationStartDatea=ConvertMMDDYYYY($('#txtMeetingStartDate').val()) + " " + validationstartHoursWithMinutes; 
    var txtEventStartDate = ConvertMMDDYYYY($('#txtMeetingStartDate').val()) + " " + startHoursWithMinutes;
    var txtEventEndDate = ConvertMMDDYYYY($('#txtMeetingEndDate').val()) + " " + endHoursWithMinutes;
    var txtNewEventDescription = $('#txtNewMeetingDescription').val().trim();
    if(txtNewEventDescription.length==0)
    {
	     alert('Please enter meeting description');
	     return false;
    }
    if(txtNewEventDescription.length>1000)
    {
	     alert('Meeting Description maximum 1000 characters allowed.');
	     return false;
    }
    var ddlNewEventCategory = $('#ddlNewMeetingCategory').val();
    
    if(ddlNewEventCategory==null || ddlNewEventCategory=="")
    {
         alert('Please select meeting category.');
	     return false;

    }
    if(compareStartDateEndDate(txtEventStartDate,txtEventEndDate)==false)
    {
      return false;
    }
    
    
    var roomValidation=CheckAvailabbleRooms(validationStartDatea, txtEventEndDate,txtEventItemLocation,meetinggRoomLocationn);
    if(roomValidation==false)
    {
	    alert('Room is already booked for this slot.');
	    return false;
    }
    
    
    
    
    AddNewMeetingMetadata(txtEventItemTitle, txtEventItemLocation, txtEventStartDate, txtEventEndDate, txtNewEventDescription, ddlNewEventCategory,meetinggRoomLocationn);
   
});
$(".closeMeetingForm").click(function(){
		
		$("#myAddNewMeetingModal").modal('hide');
});

	SP.SOD.executeOrDelayUntilScriptLoaded(getCurrentURL_GetMeetingRoomEvent,"sp.js"); 
	
}); 

function CheckAvailabbleRooms(startdatea, endates, roomss, location) {

    var val_flag = true;
    var companySiteUrlLink = titanForWork.getQueryStringParameter("CompanySiteUrl");
    var startdateaes = new Date(startdatea);
    var tStart = startdateaes.toISOString();
    var endatestv = new Date(endates);
    var vEnd = endatestv.toISOString();//EndDate
   
    var filterData = "&$filter=EndDate ge datetime'" + tStart + "' and Rooms eq '" + roomss + "' and Location eq '" + location + "'";
    var listName = 'MeetingRoom';
    var siteURL = companySiteUrlLink + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=ID,Title,Rooms,Location,EventDate,EndDate" + filterData;
    console.log(siteURL);
    $.ajax({
        url: siteURL,
        headers: { Accept: "application/json;odata=verbose" },
        async: false,
        success: function (data) {
            var items = data.d.results;
            // alert(items.length);
            for (var index = 0; index < items.length ; index++)
            {
                if (items[index].EventDate<= vEnd)
                {
                    val_flag = false;
                    var uuu = new Date(items[index].EventDate);
                    console.log(items[index].ID + "-------" + uuu);
                }
            }
        }, eror: function (data) {
            console.log($('#txtSomethingWentWrong').val());
        }
    });
    return val_flag;
}


function showMeetingonDemand(itemId)
{
    var companySiteUrlLink = titanForWork.getQueryStringParameter("CompanySiteUrl");
    var listName = 'MeetingRoom';
    var siteURL = companySiteUrlLink + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=ID,Title,Rooms,Location,EventDate,EndDate,Description,Category&$filter=ID eq '" + itemId + "'";
    $.ajax({
        url: siteURL,
        headers: { Accept: "application/json;odata=verbose" },
        async: false,
        success: function (data)
        {
            $("#myViewMeetingModal").modal('show');
            var items = data.d.results;
            if (items.length > 0)
            {
                var title = items[0].Title;
                if (title == null)
                {
                    title = "";
                }
                $('#labelMeetingTitle').text(title);
                var txtLocation = items[0].Rooms;
                if (txtLocation == null)
                {
                    txtLocation = "";
                }
                $('#labelMeetingLocation').text(txtLocation);
                
                
                 var txtLocationValue = items[0].Location;
                if (txtLocationValue == null)
                {
                    txtLocationValue = "";
                }
                $('#lblMeeTLocation').text(txtLocationValue );

                
             
                var txtEventDate = items[0].EventDate;
                if(txtEventDate!=null)
                {
                $('#labelMeetingStartDateTime').text(titanForWork.convertJSONDateAMPMWithDate(txtEventDate));
                }
                var txtEndDate = items[0].EndDate;
                if(txtEndDate!=null)
                {
                $('#labelMeetingEndDateTime').text(titanForWork.convertJSONDateAMPMWithDate(txtEndDate));
                }
                var txtDescription = items[0].Description;
                if (txtDescription == null)
                {
                    txtDescription = "";
                }
                $('#lblNewMeetingDescription').text(txtDescription);
                var txtCategory = items[0].Category;
                if (txtCategory == null)
                {
                    txtCategory = "";
                }
                $('#labelNewMeetingCategory').text(txtCategory);
                
                
                //Get Facility and show 
               var rooms= txtLocation;
               var location= txtLocationValue;
               var hmlContent=GetRoomFacility(rooms,location);
               if(hmlContent=="")
               {
                hmlContent="No Facility available !"
               }
               $('#divVIewfacility').html('');
               $('#divVIewfacility').append(hmlContent);
                
            }
        }, eror: function (data)
        {
            console.log($('#txtSomethingWentWrong').val());
        }
    });

}

function getRooms(locationValue)
{
     var listName = 'RoomMaster';
     var siteURL = "";
		 $('#txtMeetingItemLocation').empty();
		  siteURL = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=ID,Rooms&$filter=Location eq '"+locationValue+"'"
 $.ajax({
        url: siteURL,
        headers: { Accept: "application/json;odata=verbose" },
        async: true,
        success: function (data) 
        {
            var items = data.d.results;         
            for(var index=0;index<items.length;index++)
            {
               $("#txtMeetingItemLocation").append($("<option></option>").attr("value", items[index].Rooms).text(items[index].Rooms));               
            }
               var rooms= $('#txtMeetingItemLocation').val();
               var location= $('#ddlMeetingItemLocation').val();
               var hmlContent=GetRoomFacility(rooms,location);
               if(hmlContent=="")
               {
                hmlContent="No Facility available !"
               }
               $('#divfacility').html('');
               $('#divfacility').append(hmlContent);	
        }, eror: function (data) {
            console.log($('#txtSomethingWentWrong').val());
        }
    });      
}


function getMeetingCategory(categorName,databind)
{
     var listName = 'EventCategory';
       var lengt=0;
     var siteURL = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=ID,Title&$filter=Title eq '" + categorName+ "'";
		if(databind=="dropdown")
		{
		 $('#ddlNewMeetingCategory').empty();
		  siteURL = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=ID,Title"
		}   

 $.ajax({
        url: siteURL,
        headers: { Accept: "application/json;odata=verbose" },
        async: false,
        success: function (data) 
        {
            var items = data.d.results;
          
            for(var index=0;index<items.length;index++)
            {
              if(categorName.toLowerCase()==items[index].Title.toLowerCase())
              {
                lengt=1;
              }
              if(databind=="dropdown")
			  {
               $("#ddlNewMeetingCategory").append($("<option></option>").attr("value", items[index].Title).text(items[index].Title)); 
              }
              
            }
           
        }, eror: function (data) {
            console.log($('#txtSomethingWentWrong').val());
        }
    }); 
     return lengt;   
}

function compareStartDateEndDate(startDate, endDate)
{

     var date = new Date();
    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = date.getHours() >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0' + minutes : minutes;
    var strTime = hours + ':' + minutes + ' ' + ampm;
    var  currentdateandTime =(date.getMonth()+1) + "/" + date.getDate() + "/" + date.getFullYear() + " " + strTime;
     var datec=new Date(currentdateandTime);
     var kdate=new Date(startDate);
      
    var txtstartdate = new Date(startDate);
    var txtenddate = new Date(endDate);

    if(kdate<datec)
    {
	    alert("StartTime can't be less than the current time.");
	    return false;
    }
    if (txtenddate <= txtstartdate)
    {
        alert('Please change meeting Start DateTime or End DateTime.');
        return false
    }
     return true;
}

 function ConvertMMDDYYYY(datestringDDMMYYYY)
{
    var dateDays = datestringDDMMYYYY.split('/')[0];
    var dateMonth=datestringDDMMYYYY.split('/')[1];
    var dateYear=datestringDDMMYYYY.split('/')[2];
    var mmddyyyFormat = dateMonth + "/" + dateDays + "/" + dateYear;
    return mmddyyyFormat;
}

 function AddNewMeetingMetadata(evetTitle, txtEventItemLocation, thisEventDate, thisEventEndDate, eventDescription, eventCategory,meetinggRoomLocationn)
{
   var companySiteUrlLink= titanForWork.getQueryStringParameter("CompanySiteUrl");
    var ListName="MeetingRoom";
    var Metadata;
    var ItemType = GetItemTypeForListNameDetails(ListName);
    Metadata = {
        __metadata: {
            'type': ItemType
        },
        Title:evetTitle,
        Rooms:txtEventItemLocation,
        EventDate:thisEventDate,
        EndDate:thisEventEndDate,
        Description:eventDescription,
        Category: eventCategory,
        Location:meetinggRoomLocationn
    };
    
     if (evetTitle == null || evetTitle=="")
    {
        delete Metadata["Title"];
    }
    if (txtEventItemLocation== null || txtEventItemLocation== "") {
        delete Metadata["Rooms"];
    }
    if (thisEventDate == null || thisEventDate == "") {
        delete Metadata["EventDate"];
    }
    if (thisEventEndDate == null || thisEventEndDate == "") {
        delete Metadata["EndDate"];
    }
    if (eventDescription == null || eventDescription == "") {
        delete Metadata["Description"];
    }
    if (eventCategory == null || eventCategory == "") {
        delete Metadata["Category"];
    }
    
	$.when(AddNewMeeting(ListName, Metadata, companySiteUrlLink)).done(function (itemresponse) 
	 {
	    alert('Meeting room has been booked.');
        $("#myAddNewMeetingModal").modal('hide');
          var siteURL = titanForWork.getQueryStringParameter("CompanySiteUrl");
          clientContext = new SP.ClientContext(siteURL);
          curreWbeurl = siteURL;
          GetMeetingDetails(clientContext);
          	
          // NotificationCenter(evetTitle,eventDescription);	// Add Notification into Notification Center 
     });
}
function GetRoomFacility(rooms,location)
{
    var htmlconetnt="";
    var listName = 'RoomMaster';
    var siteURL = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=ID,Facility,Occupancy,Description,Rooms,Location&$filter=Rooms eq '" + rooms + "' and Location eq '" + location + "'";
    $.ajax({
        url: siteURL,
        headers: { Accept: "application/json;odata=verbose" },
        async: false,
        success: function (data)
        {        
            var items = data.d.results;
            if(items.length>0)
            {
                htmlconetnt += "<div>"
	            var facility = items[0].Facility;
	            if(facility!=null)
	            {
	              htmlconetnt += "<label class='facilitylabel'>Facility :</label>" + facility;
	            }
	            var occupancy = items[0].Occupancy;
	            if(occupancy!=null)
	            {
	              htmlconetnt += "<br/><label class='facilitylabel'>Occupancy :</label>" + occupancy;
	            }
	            var description = items[0].Description;
	            if(description!=null)
	            {
	              htmlconetnt += "<br/><label class='facilitylabel'>Description :</label>" + description;  
	            }
	            htmlconetnt += "</div>";
	            if(facility==null && occupancy==null && description==null)
	            {
	              htmlconetnt="";
	            }
            }
        }, eror: function (data)
        {
            console.log($('#txtSomethingWentWrong').val());
        }
    });
    return htmlconetnt;
}

//////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////// Add Notification into Notification Center List  //////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////
function NotificationCenter(title,description)
{
	try
    {
		var companyId= titanForWork.getQueryStringParameter('CompanyId');
        var Metadata;
        var ItemType = GetItemTypeForListName("NotificationCenter");
            Metadata = {
                __metadata: {
                    'type': ItemType
                },
			   
               Title: title,
               Details: description,
			   WebpartName:"Meeting Room",
			   CompanyIdId:companyId
			};
            AddItemIntoNotificationCenter("NotificationCenter", Metadata);         
    }
    catch (error)
    {
        console.log(error.message);
    }
}

function  AddItemIntoNotificationCenter(ListName, Metadata) 
{
	var requestURI= _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + ListName + "')/items";
	
	var dfd = $.Deferred();
    $.ajax({
        url: requestURI,
        type: "POST",
        async: false,
        headers: {
            "accept": "application/json;odata=verbose",
            "X-RequestDigest": $("#__REQUESTDIGEST").val(),
            "content-Type": "application/json;odata=verbose"
        },
        data: JSON.stringify(Metadata),
        success: function (data) {
            dfd.resolve(data);
		},
        error: function (error) {
			//alert(JSON.stringify(error));
            dfd.reject(error);
        }
    });
    return dfd.promise();
}
/////////////////////////////////////////////////////////////////////



function AddMeetingCategory(eventCategory)
{
    var companySiteUrlLink =_spPageContextInfo.webAbsoluteUrl;
    var ListName = "EventCategory";
    var Metadata;
    var ItemType = GetItemTypeForListNameDetails(ListName);
    Metadata = {
        __metadata: {
            'type': ItemType
        },
        Title: eventCategory
    };

    if (eventCategory == null || eventCategory == "") {
        delete Metadata["Title"];
    }

    $.when(AddNewMeeting(ListName, Metadata, companySiteUrlLink)).done(function (itemresponse) 
    {
        alert('Meeting category created.');
        $("#myMeetingCategoryModal").modal('hide');  
        getMeetingCategory("","dropdown");
           getEventCategory("","dropdown");
    });   
}
function AddNewMeeting(ListName, Metadata, companySitesURL)
{
    var dfd = $.Deferred();
    $.ajax({
        url: companySitesURL + "/_api/web/lists/getbytitle('" + ListName + "')/items",
        type: "POST",
        async: false,
        headers: {
            "accept": "application/json;odata=verbose",
            "X-RequestDigest": $("#__REQUESTDIGEST").val(),
            "content-Type": "application/json;odata=verbose"
        },
        data: JSON.stringify(Metadata),
        success: function (data) 
        {
          
            dfd.resolve(data);
                     
        },
        error: function (error) {
            alert(JSON.stringify(error));
            dfd.reject(error);
        }
    });
    return dfd.promise();
}
function GetItemTypeForListNameDetails(ListName) {
    return "SP.Data." + ListName.charAt(0).toUpperCase() + ListName.split(" ").join("").slice(1) + "ListItem";
}

 
var curreWbeurl = "";
function getCurrentURL_GetMeetingRoomEvent() {
   // var listName = 'Companies';
  //  var txtCompanyId = titanForWork.getQueryStringParameter("CompanyId");
    //var siteURL = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=ID,SiteURL&$filter=ID eq '" + txtCompanyId + "'";
    //$.ajax({
    //    url: siteURL,
    //    headers: { Accept: "application/json;odata=verbose" },
    //    async: false,
    //    success: function (data) {
    //        var items = data.d.results;
    //        if (items.length > 0) {
                var siteURL = titanForWork.getQueryStringParameter("CompanySiteUrl");// items[0].SiteURL;
                clientContext = new SP.ClientContext(siteURL);
                curreWbeurl = siteURL;
                GetMeetingDetails(clientContext);
    //        }

    //    }, eror: function (data) {
    //        console.log($('#txtSomethingWentWrong').val());
    //    }
    //});
}

function GetMeetingDetails(clientContext){
	


	var today = new Date();
	var dd = today.getDate();

	var mm = today.getMonth()+1; 
	var yyyy = today.getFullYear();
	if(dd<10) 
	{
		dd='0'+dd;
	} 

	if(mm<10) 
	{
		mm='0'+mm;
	}	 
	today = yyyy+'-'+mm+'-'+dd;
	
	var txtCompanyId =  titanForWork.getQueryStringParameter("CompanyId");
	var oList = clientContext.get_web().get_lists().getByTitle('MeetingRoom');
    var camlQuery = new SP.CamlQuery();
	var camlXML = "<View><Query><Where><Or><Geq><FieldRef Name='EventDate' /><Value IncludeTimeValue='TRUE' Type='DateTime'>"+today+"</Value></Geq><Geq><FieldRef Name='EndDate' /><Value IncludeTimeValue='TRUE' Type='DateTime'>"+today+"</Value></Geq></Or></Where><OrderBy><FieldRef Name='EventDate' /></OrderBy></Query><RowLimit>3</RowLimit></View>";
	camlQuery.set_viewXml(camlXML);
	var collListItem = oList.getItems(camlQuery);        
	clientContext.load(collListItem);        
	clientContext.executeQueryAsync(function(){
		var MeetingRoomHTML = '';
		var listItemEnumerator = collListItem.getEnumerator();
		var ItemCount=collListItem.get_count();
		
		// Check Records. If not found then show message of no record found.
        if(ItemCount==0)
		{
			var meetingRoomHTML='';
			meetingRoomHTML="<div class=\"norecordfound col-sm-8 col-xs-8 col-md-8\">";
            //meetingRoomHTML+="<h3 data-localize='NoRecord_MeetingRoomBooking' class=\"top5\"></h3>";
			meetingRoomHTML+="<h3 class=\"top5\" data-localize='NoRecord_MeetingRoomBooking'>Meeting Rooms are available today</h3>";
            meetingRoomHTML+="</div>";

			$("#divMeetingRoom").append(meetingRoomHTML);
			return;
		}

		
		var counter=1;
		
		while (listItemEnumerator.moveNext()) 
			{	
				var oListItem = listItemEnumerator.get_current();
				
				var eventTitle=oListItem.get_item('Title');
				var ItemID=oListItem.get_item('ID');
			//	var linkurlDispMeeting="javascript:OpenPopUpPageWithTitle('"+curreWbeurl+"/Lists/MeetingRoom/DispForm.aspx?ID="+ItemID+"',null,null,null,'Meeting')";
					var linkurlDispMeeting="javascript:showMeetingonDemand('"+ItemID+"')";
				var eventStartDate=oListItem.get_item('EventDate');
				var eventDateObj=new Date(eventStartDate);
				
				var eventDate=eventDateObj.getDate();
				//var eventMonth=eventDateObj.getMonth();
				var monthNames = ["January", "February", "March", "April", "May", "June",
				"July", "August", "September", "October", "November", "December"
				];
				var eventMonth = monthNames[eventDateObj.getMonth()];
				eventMonth=eventMonth.substring(0,3);
				
				var eventStratedHour=eventDateObj.getHours();
				var eventStratedMin =eventDateObj.getMinutes();
				if(eventStratedMin=='')
				{
					eventStratedMin="00";
				}
				
				
				var eventEndDate=oListItem.get_item('EndDate');
				
				var eventEndDateObj=new Date(eventEndDate);
				
				var eventEndHours=eventEndDateObj.getHours();
				var eventEndMin=eventEndDateObj.getMinutes();
				if(eventEndMin=='')
				{
					eventEndMin="00";
				}
				if(eventTitle.length>28)
				{
					eventTitle=eventTitle.substring(0,25)+"...";
				}
				
				
				var createdBy=oListItem.get_item('Author');
				var MeetingcreatedBy=createdBy.get_lookupValue();
				var Rooms=oListItem.get_item('Rooms');

				if(counter==1)
				{
					MeetingRoomHTML +='<div class="row">';
					MeetingRoomHTML +='<div class="col-md-12">';
					MeetingRoomHTML +='<h4 class="event-text-head"><a href='+linkurlDispMeeting+'>'+eventTitle+'</a></h4>';
					MeetingRoomHTML +='</div>';
					
					//MeetingRoomHTML +='<div class="col-sm-6 col-xs-6">Start Time</div><div class="col-sm-6 col-xs-6 pull-right">End Time</div>';
					//MeetingRoomHTML +='<div class="col-sm-12 col-xs-12 ">'+eventStratedHour+':'+eventStratedMin+' - '+eventEndHours+':'+eventEndMin+' &nbsp;&nbsp; @ '+ Rooms +'</div>';
					MeetingRoomHTML +='<div class="col-sm-12 col-xs-12 fnt-sz-12">'+eventStratedHour+':'+eventStratedMin+' - '+eventEndHours+':'+eventEndMin+'</div>';					
					MeetingRoomHTML +='<div class="col-sm-12 col-xs-12 fnt-sz-12">'+ Rooms +'</div>';
					MeetingRoomHTML +='<div class="col-sm-12 fnt-sz-12">By '+MeetingcreatedBy+'</div>';
					MeetingRoomHTML +='</div>';
				}
				else
				{
					MeetingRoomHTML +='<div class="row mrgn-tp10">';
					MeetingRoomHTML +='<div class="col-md-12">';
					MeetingRoomHTML +='<h4 class="event-text-head"><a href='+linkurlDispMeeting+'>'+eventTitle+'</a></h4>';
					MeetingRoomHTML +='</div>';

					//MeetingRoomHTML +='<div class="col-sm-6 col-xs-6">Start Time</div><div class="col-sm-6 col-xs-6 pull-right">End Time</div>';
					//MeetingRoomHTML +='<div class="col-sm-12 col-xs-12">'+eventStratedHour+':'+eventStratedMin+' - '+eventEndHours+':'+eventEndMin+' &nbsp;&nbsp; @ '+ Rooms +'</div>';
					MeetingRoomHTML +='<div class="col-sm-12 col-xs-12 fnt-sz-12">'+eventStratedHour+':'+eventStratedMin+' - '+eventEndHours+':'+eventEndMin+'</div>';
					MeetingRoomHTML +='<div class="col-sm-12 col-xs-12 fnt-sz-12">'+ Rooms +'</div>';					
					MeetingRoomHTML +='<div class="col-sm-12 col-xs-12 fnt-sz-12">By '+MeetingcreatedBy+'</div>';
					MeetingRoomHTML +='</div>';
				}
				counter++;
			}
		
			$("#divMeetingRoom").html('');
			$("#divMeetingRoom").append(MeetingRoomHTML);
		}, 
		
	function(){
		console.log('error : ViewPolls web part');
	});
}

function GetOfficeLocation()
{
    var companyID=titanForWork.getQueryStringParameter('CompanyId');
     $('#ddlMeetingItemLocation').empty();
     var Ownurl = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/GetByTitle('OfficeLocation')/items?$select=ID,OfficeName,CompanyID/ID&$expand=CompanyID&$filter=OfficeLocationId eq '0' and CompanyID/ID eq '" + companyID+ "'";
        $.ajax({  
            url: Ownurl,  
            headers: { Accept: "application/json;odata=verbose" },  
            async:false,  
            success: function (data) 
			{  
                var items = data.d.results;   	              	 
                for(var i = 0; i < items.length; i++)
                {
                  $("#ddlMeetingItemLocation").append($("<option></option>").attr("value", data.d.results[i].OfficeName).text(data.d.results[i].OfficeName));                
                }
           			
            },eror: function (data) {  
                console.log('error');
            }  
        });  	
}


</script>

<div id="divMeetingRoom">
</div>


<!-----------Meeting Model Popup---------------->


<div class="modal fade" id="myAddNewMeetingModal" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header panel-head-4">
                <button type="button" class="close h4-color" data-dismiss="modal">&times;</button>
                <h4 class="modal-title h4-color" data-localize="AddNewMeeting">Add New Meeting</h4>
            </div>
            <div class="modal-body">
                <div class="row">                                       
                        <div class="panel-body">
                            <div class="form-horizontal">

                                <div class="form-group">
                                    <label for="" class="col-sm-3 control-label required" data-localize="Title"></label>
                                    <div class="col-sm-8">
                                        <input type="text"  id="txtMeetingItemTitle" class="form-control">
                                    </div>
                                </div>
                                  <div class="form-group">
                                    <label for="" class="col-sm-3 control-label required" data-localize="Location">Location</label>
                                    <div class="col-sm-8">
                                          <select id="ddlMeetingItemLocation" class="form-control">
                                           
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="" class="col-sm-3 control-label required" data-localize="MeetingRoom">Room</label>
                                    <div class="col-sm-8">
                                          <select id="txtMeetingItemLocation" class="form-control">
                                        </select>
                                        <label for="" class="control-label event-label-right-md"  data-localize="AvailableFacility">Available facilities.</label>
                                        <div id="divfacility"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="col-sm-3 control-label required float-left-cls" data-localize="StartTime">Start Time</label>
                                    <div class="col-sm-4 mrg-btm12-pop float-left-cls">
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="date" readonly="readonly" id="txtMeetingStartDate">
                                        </div>
                                    </div>
                                    <div class="col-sm-4 form-inline float-left-cls">
                                        <select name="select2" id="ddlMeetingStartTime" class="form-control mrg-btm12-pop">
                                            <option value="12 AM">12 AM</option>
											<option value="1 AM">1 AM</option>
											<option value="2 AM">2 AM</option>
											<option value="3 AM">3 AM</option>
											<option value="4 AM">4 AM</option>
											<option value="5 AM">5 AM</option>
											<option value="6 AM">6 AM</option>
											<option value="7 AM">7 AM</option>
											<option value="8 AM">8 AM</option>
											<option value="9 AM">9 AM</option>
											<option value="10 AM">10 AM</option>
											<option value="11 AM">11 AM</option>
											<option value="12 PM">12 PM</option>
											<option value="1 PM">1 PM</option>
											<option value="2 PM">2 PM</option>
											<option value="3 PM">3 PM</option>
											<option value="4 PM">4 PM</option>
											<option value="5 PM">5 PM</option>
											<option value="6 PM">6 PM</option>
											<option value="7 PM">7 PM</option>
											<option value="8 PM">8 PM</option>
											<option value="9 PM">9 PM</option>
											<option value="10 PM">10 PM</option>
											<option value="11 PM">11 PM</option>       
											</select>
                                        <select name="select2" id="ddlMeetingStartMinutes" class="form-control mrg-btm12-pop">
                                            <option value="00">00</option>
											<option value="05">05</option>
											<option value="10">10</option>
											<option value="15">15</option>
											<option value="20">20</option>
											<option value="25">25</option>
											<option value="30">30</option>
											<option value="35">35</option>
											<option value="40">40</option>
											<option value="45">45</option>
											<option value="50">50</option>
											<option value="55">55</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="col-sm-3 control-label required float-left-cls" data-localize="EndTime">End Time</label>
                                    <div class="col-sm-4 mrg-btm12-pop float-left-cls">
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="date" readonly="readonly" id="txtMeetingEndDate">
                                        </div>
                                    </div>
                                    <div class="col-sm-4 form-inline float-left-cls">
                                        <select name="select2" id="ddlMeetingEndTime" class="form-control mrg-btm12-pop">
                                            <option value="12 AM">12 AM</option>
											<option value="1 AM">1 AM</option>
											<option value="2 AM">2 AM</option>
											<option value="3 AM">3 AM</option>
											<option value="4 AM">4 AM</option>
											<option value="5 AM">5 AM</option>
											<option value="6 AM">6 AM</option>
											<option value="7 AM">7 AM</option>
											<option value="8 AM">8 AM</option>
											<option value="9 AM">9 AM</option>
											<option value="10 AM">10 AM</option>
											<option value="11 AM">11 AM</option>
											<option value="12 PM">12 PM</option>
											<option value="1 PM">1 PM</option>
											<option value="2 PM">2 PM</option>
											<option value="3 PM">3 PM</option>
											<option value="4 PM">4 PM</option>
											<option value="5 PM">5 PM</option>
											<option value="6 PM">6 PM</option>
											<option value="7 PM">7 PM</option>
											<option value="8 PM">8 PM</option>
											<option value="9 PM">9 PM</option>
											<option value="10 PM">10 PM</option>
											<option value="11 PM">11 PM</option>                                
											</select>
                                        <select name="select2" id="ddlMeetingEndMinutes" class="form-control mrg-btm12-pop">
                                            <option value="00">00</option>
											<option value="05">05</option>
											<option value="10">10</option>
											<option value="15">15</option>
											<option value="20">20</option>
											<option value="25">25</option>
											<option value="30">30</option>
											<option value="35">35</option>
											<option value="40">40</option>
											<option value="45">45</option>
											<option value="50">50</option>
											<option value="55">55</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="col-sm-3 control-label required" data-localize="Description">Description</label>
                                    <div class="col-sm-8">
                                        <textarea type="text" id="txtNewMeetingDescription" cols="10" rows="5" class="form-control"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="col-sm-3 control-label required" data-localize="Category">Category</label>
                                    <div class="col-sm-5">
                                        <select id="ddlNewMeetingCategory" class="form-control mrg-btm12-pop">
                                           
                                        </select>
                                    </div>
                                    <div class=" col-sm-2" style="">
                               
                                      <button type="button" class="btn btn-outline-primary addnewMeetingCategoryModel"><label data-localize="Add" >Add New</label></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/panel content-->
                   
                   <!-- <div class="form-group">-->
                      <!--  <label for="" class="col-sm-4 control-label"></label> -->
                        <div class="row text-center">
                            <button type="button" class="btn btn-outline-success addNewCompanyMeeting"><label data-localize="Submit">Submit</label></button>
                            <button type="button" class="btn btn-outline-secondary closeMeetingForm"><label data-localize="Close">Close</label></button>
                        </div>
                   <!-- </div>-->
                </div>             
            </div>
        </div>
    </div>
</div>
<!--------------------------View Meeting----------------->
<div class="modal fade" id="myViewMeetingModal" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header panel-head-4">
                <button type="button" class="close h4-color" data-dismiss="modal">&times;</button>
                <h4 class="modal-title h4-color" data-localize="Meeting">Meeting</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="panel-body">
                        <div class="form-horizontal">

                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label" data-localize="Title">Title</label>
                                <div class="col-sm-8">
                                    <label for="" class="control-label event-label-right-md" id="labelMeetingTitle"></label>
                                </div>
                            </div>
                             <div class="form-group">
                                <label for="" class="col-sm-4 control-label" data-localize="Location">Location</label>
                                <div class="col-sm-8">
                                    <label for="" class="control-label event-label-right-md" id="lblMeeTLocation"></label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label" data-localize="MeetingRoom">Room</label>
                                <div class="col-sm-8">
                                    <label for="" class="control-label event-label-right-md"  id="labelMeetingLocation"></label>
                                    <br/>
                                    <label for="" class="control-label event-label-right-md"  data-localize="AvailableFacility">Available facilities.</label>
                                    <div id="divVIewfacility"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label" data-localize="StartTime">Start Time</label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <label for="" class="control-label event-label-right-md" id="labelMeetingStartDateTime"></label>
                                    </div>
                                </div>  
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label" data-localize="EndTime">End Time</label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <label for="" class="control-label event-label-right-md"  id="labelMeetingEndDateTime"></label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label" data-localize="Description">Description</label>
                                <div class="col-sm-8">
                                 <!---   <textarea type="text" id="lblNewMeetingDescription" readonly="readonly" cols="10" rows="5" class="form-control"></textarea>-->
                                   <label class="control-label event-label-right-md" id="lblNewMeetingDescription"></label>

                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label" data-localize="Category">Category</label>
                                <div class="col-sm-6">
                                    <label for="" class="control-label event-label-right-md"  id="labelNewMeetingCategory"></label>
                                </div>
                               
                            </div>
                        </div>
                    </div>
                    <!--/panel content-->                   
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="myMeetingCategoryModal" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header panel-head-4">
                <button type="button" class="close h4-color" data-dismiss="modal">&times;</button>
                <h4 class="modal-title h4-color" data-localize="MeetingCategory">Meeting Category</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="panel-body">
                        <div class="form-horizontal">

                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label required" data-localize="NewCategory">New Category</label>
                                <div class="col-sm-8">
                                      <input type="text" class="form-control" id="txtMeetingcategory" maxlength="100">                                     
                                </div>
                           </div>
                           
                        </div>
						<div class="row text-center top15">
							<button type="button" class="btn btn-outline-success addnewMeetingCategory"><label data-localize="Add">Add</label></button>
						</div>
                    </div>
                    <!--/panel content-->                   
                </div>
            </div>
        </div>
    </div>
</div>



<html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"><head>
<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:_dlc_DocId msdt:dt="string">ADMIN-1645029823-384</mso:_dlc_DocId>
<mso:_dlc_DocIdItemGuid msdt:dt="string">f19faa50-0249-4b6e-8dfc-16616b4772a9</mso:_dlc_DocIdItemGuid>
<mso:_dlc_DocIdUrl msdt:dt="string">https://adaptindia.sharepoint.com/sites/Titan_2_2_1_DEV/_layouts/15/DocIdRedir.aspx?ID=ADMIN-1645029823-384, ADMIN-1645029823-384</mso:_dlc_DocIdUrl>
<mso:MediaServiceImageTags msdt:dt="string"></mso:MediaServiceImageTags>
<mso:lcf76f155ced4ddcb4097134ff3c332f msdt:dt="string"></mso:lcf76f155ced4ddcb4097134ff3c332f>
<mso:TaxCatchAll msdt:dt="string"></mso:TaxCatchAll>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>